==============
Reorder Buffer
==============

Буфер змінного порядку або буфер відновлення послідовності дозволяє
відстежувати виконання інструкцій зберігаючи чітку послідовність.
Після модуля перейменовування в нас з'являється запитання як відстежувати
виконані інструкції. Тому, що після перейменування і виконання інструкції
відбувається процедура здійснення "commit". Якщо це зробити раніше
ми отримаємо не коректне значення оскільки даний регістр може бути
використаний для інших інструкцій.

.. image:: ../img/rob.png
   :width: 800
   :align: center

Модуль побудований на основі кільцевого буфера.
Показник "tail" вказує на комірку для запису нової інструкції.
Показник "head" вказує на інструкції які готуються для commit.

В кожній банці є комірки в яких зберігаються інструкції.
Комірка банки має:

- Адресу для пакета інструкцій;
- Біт валідності;
- Біт зайнятості;
- Попередній регістр;
- Новий регістр;
- Маска гілки.

Запис відбувається одночасно для пакетів.
Кожна інструкція відповідно до банки.
При цьому модуль повертає тег за допомогою якого відбувається звернення
в наступних етапах.
Адреса зберігається окремо і представляє весь рядок.
В даному буфері зберігається вирівнення інструкцій тому номер банки вказує
на зміщення інструкції в пакеті. Тому ми можемо відновити адресу інструкції
і цим заощадити ресурси які виділяють для адреси.

В кожній комірці є біт валідності та зайнятості.
Після виконання інструкції за допомогою тегу відбувається звернення до комірки
щоб скинути біта зайнятості.

Commit Stage
~~~~~~~~~~~~

Якщо в комірці на яку вказує head в усіх пакетах скинутий біт зайнятості або
дійсності то відбувається commit і `head` зміщується.
У випадку дійсної інструкції повертається старе значення в іншому випадку
модуль повертає нове значення оскільки перейменовування не повинно було
відбутися, але воно сталося.
Регістр відправляється в чергу вільних регістрів `freelist`.

Jump miss
~~~~~~~~~

Якщо відбулося не коректне передбачення адреси в модуль відправляється
маска і всі комірки які не підпадають під маску скидають біт дійсності.
Після чого вони повернуть нове перейменування регістра в чергу `freelist`.
